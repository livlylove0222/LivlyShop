<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="bookmark" href="favicon.ico">
  <link rel="stylesheet" href="style.css">
  <title>格萊德里</title>
</head>

<body>
  <div class="btn">
    <button id="saveBtn">儲存</button>
    <button id="clearBtn">清除</button>
  </div>
  <div class="all">
    <div class="count">
      <div class="img"><img src="images/gs.jpg" alt=""></div>
      <div class="shop"></div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script>
    function generateBuyBlocks(buyCount, inputsPerBuy) {
      for (let i = 0; i < buyCount; i++) {
        const $buy = $('<div class="buy"></div>');
        for (let j = 0; j < inputsPerBuy; j++) {
          const $inputs = $(`
          <div class="inputs">
            <label><input class="userCheck" type="checkbox"></label>
            <input type="text" class="userInput">
          </div>
        `);
          $buy.append($inputs);
        }
        $('.shop').append($buy);
      }
    }

    // 將 getCookie 移出 ready 區塊
    function getCookie(name) {
      let cookies = document.cookie.split("; ");
      for (let i = 0; i < cookies.length; i++) {
        let parts = cookies[i].split("=");
        if (parts[0] === name) {
          return decodeURIComponent(parts[1]);
        }
      }
      return "";
    }

    function loadFromCookie() {
      let inputData = getCookie("userInputs");
      let checkData = getCookie("userChecks");

      if (inputData) {
        let inputs = JSON.parse(inputData);
        $(".userInput").each(function (index) {
          if (inputs[index] !== undefined) {
            $(this).val(inputs[index]);
          }
        });
      }

      if (checkData) {
        let checks = JSON.parse(checkData);
        $(".userCheck").each(function (index) {
          if (checks[index] !== undefined) {
            $(this).prop("checked", checks[index] === 1);
          }
        });
      }
    }

    $(document).ready(function () {
      generateBuyBlocks(7, 5); // 先產生區塊
      loadFromCookie();        // 然後還原 cookie 資料

      // 儲存 Cookie
      $("#saveBtn").click(function () {
        let inputs = [];
        $(".userInput").each(function () {
          inputs.push($(this).val());
        });

        let checks = [];
        $(".userCheck").each(function () {
          checks.push($(this).prop("checked") ? 1 : 0);
        });

        document.cookie = "userInputs=" + JSON.stringify(inputs) + "; path=/";
        document.cookie = "userChecks=" + JSON.stringify(checks) + "; path=/";
        showNotification("已儲存");
      });

      // 清除 Cookie
      $("#clearBtn").click(function () {
        document.cookie = "userInputs=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        document.cookie = "userChecks=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        $(".userInput").val("");
        $(".userCheck").prop("checked", false);
        showNotification("已清除");
      });

      function showNotification(message) {
        let $notification = $("<div class='notification'></div>").text(message);
        $("body").append($notification);
        $notification.animate({ top: "-=50px", opacity: 0 }, 700, function () {
          $(this).remove();
        });
      }
    });
  </script>

</body>

</html>