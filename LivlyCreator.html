<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/LivlyShop/favicon.ico">
  <link rel="stylesheet" href="style.css">
  <title>創作者週</title>
</head>

<body>
  <div class="boxAll">
    <div class="right fixed">
      <!-- 控制按鈕區 -->
      <div id="controls">
        <div class="btn">
          <button onclick="saveAllShops()">儲存資料</button>
          <button onclick="loadAllShops()">載入資料</button>
          <button onclick="clearAllShops()">清除資料</button>
        </div>
      </div>

      <!-- 所有店家容器 -->
      <div id="all-shops" class="all-shops"></div>
    </div>
  </div>

  <script>
    // 店家設定
    const shops = [
      {
        id: 'tba',
        name: '梱包 tba',
        path: 'images/livCreat/tba/',
        itemCount: 16,
        separators: [2, 14]
      },
      {
        id: 'moco',
        name: 'moco',
        path: 'images/livCreat/moco/',
        itemCount: 18,
        separators: [6, 16]
      },
      {
        id: 'INARI',
        name: 'INARI',
        path: 'images/livCreat/INARI/',
        itemCount: 18,
        separators: [5, 14]
      },
      {
        id: 'Citron',
        name: 'シトロン',
        path: 'images/livCreat/Citron/',
        itemCount: 18,
        separators: [16]
      },
      {
        id: 'Medici',
        name: 'メディチ',
        path: 'images/livCreat/Medici/',
        itemCount: 8,
        separators: [5, 6]
      }
    ];

    // 產生所有店家的項目
    function generateAllShops() {
      const container = document.getElementById('all-shops');
      container.innerHTML = '';

      shops.forEach(shop => {
        // 建立外層容器
        const shopWrapper = document.createElement('div');
        shopWrapper.className = 'shop-wrapper';
        shopWrapper.dataset.shopId = shop.id;
        // 建立店家標題
        const title = document.createElement('h2');
        title.textContent = shop.name;
        title.className = 'shop-title';
        shopWrapper.appendChild(title);  // ← 改成加到 wrapper

        // 建立店家區塊
        const shopSection = document.createElement('div');
        shopSection.className = 'buy';
        shopSection.dataset.shopId = shop.id;

        // 產生道具項目
        for (let i = 1; i <= shop.itemCount; i++) {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'inputs';
          itemDiv.dataset.originalIndex = i;
          itemDiv.dataset.shopId = shop.id;

          itemDiv.innerHTML = `
            <div class="item-img">
              <img src="${shop.path}img-${i}.jpg" alt="項目 ${i}">
            </div>
            <div class="item-box">
              <label>
                <input class="userCheck" type="checkbox" data-index="${i}" data-shop="${shop.id}">
                <span class="checkmark"></span>
              </label>
              <input type="number" class="userInput" data-index="${i}" data-shop="${shop.id}" min="0">
            </div>
          `;

          shopSection.appendChild(itemDiv);

          // 檢查是否需要在此位置加入分隔線
          if (shop.separators.includes(i)) {
            const separator = document.createElement('hr');
            separator.className = 'separator';
            separator.dataset.position = i;
            shopSection.appendChild(separator);
          }
        }

        shopWrapper.appendChild(shopSection);  // ← 改成加到 wrapper
        container.appendChild(shopWrapper);     // ← 最後把 wrapper 加到 container
      });
    }

    // 儲存所有店家資料到Cookie
    function saveAllShops() {
      shops.forEach(shop => {
        const data = {
          checkboxes: {},
          inputs: {}
        };

        // 收集該店家的checkbox狀態
        document.querySelectorAll(`.userCheck[data-shop="${shop.id}"]`).forEach(checkbox => {
          const index = checkbox.dataset.index;
          data.checkboxes[index] = checkbox.checked;
        });

        // 收集該店家的input值
        document.querySelectorAll(`.userInput[data-shop="${shop.id}"]`).forEach(input => {
          const index = input.dataset.index;
          data.inputs[index] = input.value;
        });

        // 設定Cookie (14天期限)
        const expires = new Date();
        expires.setTime(expires.getTime() + (14 * 24 * 60 * 60 * 1000));
        document.cookie = `shopData_${shop.id}=${JSON.stringify(data)}; expires=${expires.toUTCString()}; path=/`;
      });

      showNotification("已儲存");
    }

    // 載入所有店家資料
    function loadAllShops() {
      let loadedCount = 0;

      shops.forEach(shop => {
        const cookies = document.cookie.split(';');
        let shopData = null;

        for (let cookie of cookies) {
          const [name, value] = cookie.trim().split('=');
          if (name === `shopData_${shop.id}`) {
            try {
              shopData = JSON.parse(decodeURIComponent(value));
              loadedCount++;
            } catch (e) {
              console.error('Cookie解析錯誤:', e);
              continue;
            }
            break;
          }
        }

        if (shopData) {
          // 恢復checkbox狀態
          Object.keys(shopData.checkboxes).forEach(index => {
            const checkbox = document.querySelector(`.userCheck[data-shop="${shop.id}"][data-index="${index}"]`);
            if (checkbox) {
              checkbox.checked = shopData.checkboxes[index];
            }
          });

          // 恢復input值
          Object.keys(shopData.inputs).forEach(index => {
            const input = document.querySelector(`.userInput[data-shop="${shop.id}"][data-index="${index}"]`);
            if (input) {
              input.value = shopData.inputs[index];
            }
          });
        }
      });

      if (loadedCount > 0) {
        showNotification("已載入");
      } else {
        showNotification("無儲存資料");
      }
    }

    // 清除所有店家資料
    function clearAllShops() {
      shops.forEach(shop => {
        document.cookie = `shopData_${shop.id}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;

        // 清除該店家頁面上的所有勾選和輸入
        document.querySelectorAll(`.userCheck[data-shop="${shop.id}"]`).forEach(checkbox => {
          checkbox.checked = false;
        });

        document.querySelectorAll(`.userInput[data-shop="${shop.id}"]`).forEach(input => {
          input.value = '';
        });
      });

      showNotification("已清除");
    }

    // 通知訊息
    function showNotification(message) {
      let notification = document.createElement("div");
      notification.className = "notification";
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.remove();
      }, 700);
    }

    // 頁面載入時初始化
    window.onload = function () {
      // 產生所有店家的項目
      generateAllShops();

      // 自動載入已儲存的資料
      loadAllShops();
    };
  </script>

</body>

</html>